{% extends "base.html" %}

{% block title %}Reports — Expense Receipts{% endblock %}

{% block content %}
<section class="page-head">
  <h1>Reports</h1>
</section>

<form method="get" action="{{ url_for('reports.index') }}" class="form form-report card">
  <div class="form-group">
    <label for="type">Report type</label>
    <select id="type" name="type">
      <option value="">— Choose —</option>
      <option value="by_month" {% if report_type == 'by_month' %}selected{% endif %}>By month</option>
      <option value="by_tag" {% if report_type == 'by_tag' %}selected{% endif %}>By tag</option>
    </select>
  </div>
  <div class="form-row">
    <div class="form-group">
      <label for="date_from">From date</label>
      <input type="date" id="date_from" name="date_from" value="{{ date_from }}">
    </div>
    <div class="form-group">
      <label for="date_to">To date</label>
      <input type="date" id="date_to" name="date_to" value="{{ date_to }}">
    </div>
  </div>
  <div class="form-group">
    <label for="format">Output</label>
    <select id="format" name="format">
      <option value="html" {% if request.args.get('format') != 'csv' %}selected{% endif %}>View in browser</option>
      <option value="csv" {% if request.args.get('format') == 'csv' %}selected{% endif %}>Download CSV</option>
    </select>
  </div>
  <div class="form-actions">
    <button type="submit" class="btn btn-primary">Run report</button>
  </div>
</form>

{% if report_type == 'by_month' and by_month_rows is not none %}
  <h2 class="results-heading">Receipts by month</h2>
  {% if by_month_rows %}
    <table class="report-table">
      <thead>
        <tr><th>Month</th><th>Count</th></tr>
      </thead>
      <tbody>
        {% for month, count in by_month_rows %}
          <tr><td>{{ month }}</td><td>{{ count }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="empty-state">No data in this date range.</p>
  {% endif %}
{% endif %}

{% if report_type == 'by_tag' and by_tag_rows is not none %}
  <h2 class="results-heading">Receipts by tag</h2>
  {% if by_tag_rows %}
    <table class="report-table">
      <thead>
        <tr><th>Tag</th><th>Count</th></tr>
      </thead>
      <tbody>
        {% for tag_name, count in by_tag_rows %}
          <tr><td>{{ tag_name }}</td><td>{{ count }}</td></tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="empty-state">No data in this date range.</p>
  {% endif %}
{% endif %}
{% endblock %}
