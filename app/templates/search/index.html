{% extends "base.html" %}

{% block title %}Search ‚Äî Expense Receipts{% endblock %}

{% block content %}
<section class="page-head">
  <h1>Search receipts</h1>
  <a href="{{ url_for('receipts.index') }}" class="btn btn-secondary">All receipts</a>
</section>

<form method="get" action="{{ url_for('search.index') }}" class="form form-search card">
  <div class="form-group">
    <label for="tag_id">Tags (any of)</label>
    <select id="tag_id" name="tag_id" multiple size="5">
      {% for t in all_tags %}
        <option value="{{ t.id }}" {% if t.id in selected_tag_ids %}selected{% endif %}>{{ t.name }}</option>
      {% endfor %}
    </select>
    <span class="form-hint">Hold Ctrl/Cmd to select multiple.</span>
  </div>
  <div class="form-row">
    <div class="form-group">
      <label for="date_from">From date</label>
      <input type="date" id="date_from" name="date_from" value="{{ date_from }}">
    </div>
    <div class="form-group">
      <label for="date_to">To date</label>
      <input type="date" id="date_to" name="date_to" value="{{ date_to }}">
    </div>
  </div>
  <div class="form-group">
    <label for="merchant">Merchant (in name or receipt text)</label>
    <input type="text" id="merchant" name="merchant" value="{{ merchant }}" placeholder="e.g. Acme Corp" maxlength="256">
  </div>
  <div class="form-actions">
    <button type="submit" class="btn btn-primary">Search</button>
    <a href="{{ url_for('search.index') }}" class="btn btn-secondary">Clear</a>
  </div>
</form>

{% if request.args %}
  <p class="results-actions">
    <span class="results-heading">{{ receipts|length }} result(s)</span>
    <a href="{{ url_for('export.receipts_csv') }}{% if request.query_string %}?{{ request.query_string.decode('utf-8') }}{% endif %}" class="btn btn-sm btn-secondary">Export CSV</a>
  </p>
  {% if receipts %}
    <ul class="receipt-list">
      {% for r in receipts %}
        <li class="receipt-card">
          <a href="{{ url_for('receipts.detail', receipt_id=r.id) }}" class="receipt-card-link">
            <span class="receipt-icon" aria-hidden="true">
              {% if r.file_path.lower().endswith('.pdf') %}üìÑ{% else %}üñºÔ∏è{% endif %}
            </span>
            <div class="receipt-meta">
              <span class="receipt-filename">{{ r.original_filename }}</span>
              <span class="receipt-date">{{ (r.receipt_date or r.created_at).strftime('%Y-%m-%d') }}</span>
              {% if r.merchant %}<span class="receipt-merchant">{{ r.merchant }}</span>{% endif %}
              {% if r.tags %}
                <span class="tag-list">
                  {% for t in r.tags %}<span class="tag tag-sm">{{ t.name }}</span>{% endfor %}
                </span>
              {% endif %}
            </div>
          </a>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="empty-state">No receipts match your filters.</p>
  {% endif %}
{% endif %}
{% endblock %}
